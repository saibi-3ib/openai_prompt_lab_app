<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Post Collector - Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/autolinker@3.15.0/dist/Autolinker.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="font-sans">
    {% include '_nav.html' %}
    <div class="layout-wrapper">

        <div id="filter-pane-wrapper" class="collapsed"> 
            <div id="filter-pane-toggle"> <span class="toggle-icon">‚ñº</span> Áµû„ÇäËæº„Åø„Éï„Ç£„É´„Çø„Éº <span class="toggle-icon">‚ñº</span>
            </div>
            <div id="filter-pane-content" class="flex-shrink-0 border-b p-3 shadow-md z-10" style="background-color: var(--color-container-bg);">    
                <div class="flex items-center space-x-4 mb-3">
                    
                    <div class="flex-1">
                        <label for="filter-keyword" class="text-xs font-semibold text-gray-400">„Ç≠„Éº„ÉØ„Éº„Éâ</label>
                        <input type="text" id="filter-keyword" placeholder="Êú¨Êñá„ÉÜ„Ç≠„Çπ„Éà..." class="w-full text-sm rounded px-2 py-1 placeholder-gray-500">
                    </div>

                    <div class="flex-1">
                        <label for="filter-ticker-input" class="text-xs font-semibold text-gray-400">„ÉÜ„Ç£„ÉÉ„Ç´„Éº (Ë§áÊï∞ÈÅ∏ÊäûÂèØ)</label>
                        <div id="ticker-tags-container" class="w-full flex flex-wrap gap-1 p-1 rounded mt-1" style="background-color: var(--color-base-bg); border: 1px solid var(--color-container-bg); min-height: 38px;">
                            <div class="autocomplete-container flex-grow relative">
                                <input type="text" id="filter-ticker-input" placeholder="„ÉÜ„Ç£„ÉÉ„Ç´„ÉºÊ§úÁ¥¢..." class="w-full bg-transparent outline-none p-1" autocomplete="off" style="min-width: 120px;">
                                <div id="ticker-suggestions" class="autocomplete-suggestions hidden"></div> 
                            </div>
                        </div>
                    </div>
                    
                </div>

                <div class="flex items-end space-x-4">
                    
                    <div class="relative flex-1">
                        <label class="text-xs font-semibold text-gray-400">„Ç¢„Ç´„Ç¶„É≥„Éà</label>
                        <button id="account-filter-btn" class="w-full mt-1 text-sm rounded px-2 py-1 text-left flex justify-between items-center">
                            <span id="account-filter-label">„Åô„Åπ„Å¶„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="account-filter-menu" class="hidden absolute left-0 mt-1 w-full rounded shadow-lg z-20 overflow-y-auto" style="max-height: 400px;">
                            <ul class="p-1">
                                
                            {% for account_name in available_accounts %}
                                <li>
                                    <label class="flex items-center space-x-2 px-2 py-1 text-sm rounded hover:bg-gray-600 cursor-pointer">
                                        <input type="checkbox" class="account-filter-checkbox form-checkbox" value="{{ account_name }}">
                                        <span>{{ account_name }}</span>
                                    </label>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="relative flex-1">
                        <label class="text-xs font-semibold text-gray-400">„Çª„ÇØ„Çø„Éº / „Çµ„Éñ„Çª„ÇØ„Çø„Éº</label>
                        <button id="sector-filter-btn" class="w-full mt-1 text-sm rounded px-2 py-1 text-left flex justify-between items-center">
                            <span id="sector-filter-label">„Åô„Åπ„Å¶</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="sector-filter-menu" class="hidden absolute left-0 mt-1 w-full rounded shadow-lg z-20 overflow-y-auto" style="max-height: 400px;">
                            
                            <ul class="p-1">
                            {% for sector in available_sector_tree %}
                                <li> 
                                    <label class="flex items-center space-x-2 px-2 py-1 text-sm rounded hover:bg-gray-600 cursor-pointer font-bold">
                                        <input type="checkbox" class="sector-parent-cb form-checkbox" 
                                            value="{{ sector.name }}" data-sector-name="{{ sector.name }}">
                                        <span>{{ sector.name }}</span>
                                    </label>
                                    
                                    <ul class="ml-4">
                                        {% for sub_sector in sector.sub_sectors %}
                                        <li> 
                                            <label class="flex items-center space-x-2 px-2 py-1 text-sm rounded hover:bg-gray-600 cursor-pointer">
                                                <input type="checkbox" class="sector-child-cb form-checkbox" 
                                                    value="{{ sub_sector }}" data-parent-sector="{{ sector.name }}">
                                                <span>{{ sub_sector }}</span>
                                            </label>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            {% endfor %}
                            </ul>
                            
                        </div>
                    </div>

                    <div class="w-40">
                        <label for="filter-sentiment" class="text-xs font-semibold text-gray-400">„Çª„É≥„ÉÅ„É°„É≥„Éà</label>
                        <select id="filter-sentiment" class="w-full text-sm rounded px-2 py-1 mt-1">
                            <option value="">„Åô„Åπ„Å¶</option>
                            <option value="Positive">Positive</option>
                            <option value="Negative">Negative</option>
                            <option value="Neutral">Neutral</option>
                        </select>
                    </div>

                    <div class="flex space-x-2">
                        <div>
                            <label for="filter-likes" class="text-xs font-semibold text-gray-400">„ÅÑ„ÅÑ„Å≠ (n‰ª•‰∏ä)</label>
                            <input type="number" id="filter-likes" class="w-20 text-sm rounded px-2 py-1" placeholder="0">
                        </div>
                        <div>
                            <label for="filter-rts" class="text-xs font-semibold text-gray-400">RT (n‰ª•‰∏ä)</label>
                            <input type="number" id="filter-rts" class="w-20 text-sm rounded px-2 py-1" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="flex items-end space-x-2 h-full">
                        <button id="filter-run-btn" class="bg-blue-600 hover:bg-blue-700 font-bold py-1 px-4 rounded transition duration-200">
                            Áµû„ÇäËæº„Åø
                        </button>
                        <button id="filter-reset-btn" class="bg-gray-600 hover:bg-gray-700 text-xs py-1 px-2 rounded transition duration-200">
                            „É™„Çª„ÉÉ„Éà
                        </button>
                    </div>
                    
                </div>
            </div> 
        </div>

        <div id="post-pane" class="flex-1 overflow-y-auto p-3 space-y-2">
            
            <div id="post-pane-header" class="sticky top-0 py-2 px-1 mb-2 z-10">
                <button id="deselect-all-btn" class="bg-gray-600 hover:bg-gray-700 text-xs font-bold py-1 px-3 rounded transition duration-200">
                    „Åô„Åπ„Å¶ÈÅ∏ÊäûËß£Èô§
                </button>
                <span id="selection-counter" class="text-sm ml-3">0‰ª∂ ÈÅ∏Êäû‰∏≠</span>
            </div>

            <div id="post-list-container">
                {% for post in posts %}
                <div id="post-{{ post.id }}" 
                     class="post-item rounded shadow p-2 border hover:bg-gray-700 transition duration-150 ease-in-out cursor-pointer"
                     data-post-id="{{ post.id }}"
                     data-index="{{ loop.index0 }}">
                    
                    <div class="flex justify-between items-start">
                        <div class="flex items-center space-x-3">
                            <span class="font-bold text-sm post-username">{{ post.username }}</span> <span class="text-xs text-gray-400">{{ post.posted_at.strftime('%Y-%m-%d %H:%M') if post.posted_at else 'N/A' }}</span>
                        </div>
                        <div class="flex space-x-3 text-xs text-gray-400 text-right flex-shrink-0">
                            <span>‚ù§Ô∏è {{ post.like_count }}</span>
                            <span>üîÅ {{ post.retweet_count }}</span>
                            {% if post.link_summary %}
                                <span class="text-yellow-500">üîó</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mt-1">
                        <div class="post-text text-sm leading-snug"
                             data-original-text="{{ (post.original_text or '') | replace('"', '&quot;') | replace('\n', '&#10;') }}">
                        </div>
                        <div class="mt-2 flex flex-wrap gap-2 items-center">
                        {% if post.ticker_sentiments %}
                            {% for ts in post.ticker_sentiments %}
                                {% set icon = '‚ûñÔ∏è' %}
                                {% if ts.sentiment == 'Positive' %}{% set icon = '‚úÖÔ∏è' %}
                                {% elif ts.sentiment == 'Negative' %}{% set icon = '‚ùåÔ∏è' %}{% endif %}
                                <button type="button" class="ticker-btn text-xs px-2 py-1 rounded bg-gray-800 hover:bg-gray-700 border text-white"
                                        data-ticker="{{ ts.ticker }}">
                                    <span class="font-semibold mr-1">{{ ts.ticker }}</span>
                                    <span class="text-sm">{{ icon }}</span>
                                </button>
                            {% endfor %}
                        {% else %}
                            <span class="text-xs text-gray-500 italic">ÔºàÈäòÊüÑËß£Êûê„Å™„ÅóÔºâ</span>
                        {% endif %}
                    </div> 
                    </div>
                    <div class="mt-1 text-right">
                        <a href="{{ post.source_url }}" target="_blank" class="text-xs hover:underline">ÂÖÉ„ÅÆÊäïÁ®ø &rarr;</a> </div>
                </div>
                {% endfor %}
            </div>
        </div> 

        <div id="action-pane-wrapper" class="collapsed">
            
            <div id="action-pane-toggle">
                <span class="toggle-icon">‚ñº</span> „Éó„É≠„É≥„Éó„Éà & ÂÆüË°åÁµêÊûú <span class="toggle-icon">‚ñº</span>
            </div>
            
            <div id="action-pane-content">
                <div class="grid grid-cols-2 gap-4 h-full">
                    <div class="flex flex-col h-full">
                        <div class="flex space-x-4 mb-2"> 
                            <div class="flex-1"> <label for="prompt-select" class="text-xs font-semibold" style="color: var(--color-accent);">1a. „Éó„É≠„É≥„Éó„Éà„ÇíÈÅ∏Êäû</label>
                                <select id="prompt-select" class="w-full p-2 mt-1 rounded text-sm">
                                    <option value="prompt_1">Default Summary Prompt</option>
                                    <option value="prompt_2">Sentiment Analysis Prompt</option>
                                </select>
                            </div>
                            
                            <div class="w-1/3"> <label for="model-select" class="text-xs font-semibold" style="color: var(--color-accent);">1b. „É¢„Éá„É´„ÇíÈÅ∏Êäû</label>
                                <select id="model-select" class="w-full p-2 mt-1 rounded text-sm">
                                    {% for model in available_models %}
                                    <option value="{{ model }}">{{ model }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            </div>
                        <textarea id="prompt-editor" rows="10" class="w-full p-3 text-sm flex-1 rounded"></textarea>
                        <div class="mt-2 flex space-x-2">
                            <button id="save-prompt-btn" class="bg-gray-600 hover:bg-gray-700 text-xs font-bold py-1 px-3 rounded transition duration-200">‰∏äÊõ∏„Åç‰øùÂ≠ò</button>
                            <button id="save-as-new-prompt-btn" class="bg-blue-600 hover:bg-blue-700 text-xs font-bold py-1 px-3 rounded transition duration-200">ÂêçÂâç„Çí‰ªò„Åë„Å¶Êñ∞Ë¶è‰øùÂ≠ò</button>
                            <button id="delete-prompt-btn" class="bg-red-700 hover:bg-red-800 text-white text-xs font-bold py-1 px-3 rounded transition duration-200">ÂâäÈô§</button>
                        </div>
                    </div>
                    <div class="flex flex-col h-full">
                        <h3 class="text-sm font-semibold mb-2" style="color: var(--color-accent);">2. ÂÆüË°å„Å®ÁµêÊûú</h3>
                        <button id="analyze-batch-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-2 px-4 rounded transition duration-200 mb-2">
                            <span id="batch-btn-counter">0</span> ‰ª∂„Çí„Åæ„Å®„ÇÅ„Å¶ÂàÜÊûêÂÆüË°å
                        </button>
                        <div id="result-display" class="w-full p-3 text-sm flex-1 overflow-y-auto rounded"></div>
                    </div>
                </div>
            </div> 
        </div> 
    </div> 

    <script type="module" src="{{ url_for('static', filename='js/app.js') }}"></script>

</body>
</html>